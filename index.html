<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Битва на Арене — бренд в центре</title>
  <link href="https://fonts.googleapis.com/css2?family=Igra+Sans:wdth,wght@75..100,400..800&family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    @font-face {
      font-family:"UnboundedLocal";
      src: url("assets/fonts/Unbounded-Black.ttf") format("truetype"),
      url("assets/fonts/Unbounded-Bold.ttf") format("truetype"),
      url("assets/fonts/Unbounded-ExtraBold.ttf") format("truetype"),
      url("assets/fonts/Unbounded-ExtraLight.ttf") format("truetype"),
      url("assets/fonts/Unbounded-Light.ttf") format("truetype"),
      url("assets/fonts/Unbounded-Medium.ttf") format("truetype"),
      url("assets/fonts/Unbounded-Regular.ttf") format("truetype"),
      url("assets/fonts/Unbounded-SemiBold.ttf") format("truetype"),
      url("assets/fonts/Unbounded-VariableFont_wght.ttf") format("truetype");
      font-weight:200 900;
      font-style:normal;
      font-display:swap;
    }
    :root{--bg1:#0f1220;--bg2:#0b0e1a;--ink:#ffffff;--muted:#c9cedd;--acc:#6c63ff;--acc2:#4fd1ff;--panel:#1a1e2c}
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial; background: linear-gradient(180deg,var(--bg1),var(--bg2)); color:var(--ink); line-height:1.6; overflow-x:hidden}

    body.intro-active main{ filter: blur(12px) brightness(.7); transition: filter .8s ease }
    .intro{position:fixed; inset:0; background:transparent; display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:999}
    .intro::before{ content:""; position:absolute; inset:0; background:rgba(0,0,0,.35); backdrop-filter: blur(10px); transition: opacity .6s ease, backdrop-filter .8s ease }
    .intro .title{transition: opacity 1s ease,position:relative; font-family:"UnboundedLocal","Igra Sans","Ans Sans",Inter,system-ui; font-weight:800; letter-spacing:.08em; 
      font-size: clamp(52px,9vw,140px); opacity:0; transform:translateY(10px) scale(.985); animation:fadeUp .8s .15s forwards}
    .intro .subtitle{white-space:nowrap; transition: opacity 1s ease,position:relative; font-family:"UnboundedLocal","Igra Sans","Ans Sans",Inter,system-ui; font-weight:700; letter-spacing:.18em; 
      font-size: clamp(14px,2.8vw,30px); margin-top: clamp(2px, 0.75vw, 12px); opacity:0; transform:translateY(10px) scale(.985); animation:fadeUp .8s .45s forwards}
    
    .intro.fade-out{ pointer-events:none }
    .intro.fade-out::before{ opacity:0; backdrop-filter: blur(22px) }
    @keyframes fadeUp{ to{ opacity:1; transform:none } }

    #stars{position:fixed; inset:0; z-index:-4; display:block}
    .bg{position:fixed; inset:-10vh -10vw; z-index:-3; pointer-events:none; filter: blur(40px);}
    .blob{ position:absolute; border-radius:50%; opacity:.5; mix-blend-mode:screen; animation: float 22s ease-in-out infinite alternate; }
    .blob.b1{ width:55vmax; height:55vmax; left:-10vmax; top:5vmax; background:radial-gradient(closest-side, #1e2b85, transparent 70%); animation-duration:26s }
    .blob.b2{ width:50vmax; height:50vmax; right:-12vmax; top:0; background:radial-gradient(closest-side, #0a7dbb, transparent 70%); animation-duration:24s }
    .blob.b3{ width:45vmax; height:45vmax; left:20vmax; bottom:-12vmax; background:radial-gradient(closest-side, #6c63ff, transparent 70%); animation-duration:28s }
    @keyframes float{ 0% { transform: translate3d(0,0,0) scale(1);} 100% { transform: translate3d(5vmax,-3vmax,0) scale(1.05);} }

    .wrap{max-width:1100px;margin:0 auto;padding:28px 20px}
    h1,h2,h3{font-family:"UnboundedLocal","Igra Sans","Ans Sans",Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial; font-weight:800; letter-spacing:.2px}
    h1.title{font-size:56px; line-height:1.05; margin-bottom:8px}
    .deck{font-size:18px;color:var(--muted); margin-bottom:18px}
    h2.sub{font-size:28px; margin:20px 0 10px}
    h3.kicker{font-size:14px; text-transform:uppercase; letter-spacing:.2em; color:#a7b1c6; margin:26px 0 6px}
    .hr{height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.15),transparent); margin:16px 0}

    .kpi{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin:8px 0 0}
    .k{background:rgba(255,255,255,.07);padding:14px;border-radius:12px;text-align:center}
    .k .num{font-size:22px;font-weight:900;font-family:"UnboundedLocal","Igra Sans",Inter,system-ui}
    .k .lab{font-size:12px;color:var(--muted)}

    .text-box{background:rgba(255,255,255,.06); padding:16px; border-radius:14px; margin-top:10px}
    .ul{display:grid; gap:6px; margin-top:10px}
    .ul .li::before{content:"• "; color:var(--acc2); font-weight:900}

    .arena-window{position:relative;height:520px;background:var(--panel);border-radius:18px;overflow:hidden;margin-top:12px}
    canvas#arena{position:absolute;inset:0;width:100%;height:100%}
    .brand-image{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:160px;height:160px;border-radius:50%;object-fit:cover;image-rendering:auto; box-shadow:none}

    .speed-btn{position:absolute; right:14px; bottom:14px; width:64px; height:64px; border-radius:50%; background:rgba(255,255,255,.14); border:1px solid rgba(255,255,255,.25); display:flex; align-items:center; justify-content:center; font-size:22px; font-weight:900; color:#fff; user-select:none; backdrop-filter: blur(4px); transition: transform .1s ease, background .2s ease}
    .speed-btn:active{transform: scale(.97); background: rgba(255,255,255,.22)}

    .packages{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:14px;margin-top:16px;align-items:stretch}
    .pkg{background:rgba(255,255,255,.08);padding:18px;border-radius:18px;text-align:center;display:flex;flex-direction:column;align-items:center;gap:8px;min-height:170px}
    .pkg h3{font-size:18px;margin-bottom:4px;min-height:2.2em;display:flex;align-items:center;justify-content:center}
    .pkg .price{font-size:22px;font-weight:900;margin-top:auto;font-family:"UnboundedLocal","Igra Sans",Inter,system-ui}

    .footer{text-align:center;color:var(--muted);margin:36px 0 16px}
    .footer a{color:var(--muted); text-decoration: underline; text-underline-offset: 3px}

    .reveal{opacity:0; transform: translateY(18px); transition: opacity .7s ease, transform .7s cubic-bezier(.2,.8,.2,1)}
    .reveal.in{opacity:1; transform:none}
    .delay-1{transition-delay:.08s} .delay-2{transition-delay:.16s} .delay-3{transition-delay:.24s} .delay-4{transition-delay:.32s}
    @media(max-width:900px){
      h1.title{font-size:40px}
      .kpi{grid-template-columns:repeat(2,1fr)}
      .brand-image{width:130px;height:130px}
      .arena-window{height:400px}
    }
  
    .intro.out .title, .intro.out .subtitle{opacity:0}

    /* ensure smooth fade for intro text */
    .intro .title, .intro .subtitle{transition: opacity 1s ease; will-change: opacity}

    .intro.out .title, .intro.out .subtitle{animation: none !important; opacity:0}

    /* --- Stats Charts (custom) --- */
    .stats-charts{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:12px}
    .chart-card{background:rgba(255,255,255,.07);padding:16px 18px;border-radius:12px}
    .chart-card h3{font-family:"UnboundedLocal","Igra Sans",Inter,system-ui;font-weight:900;font-size:20px;margin-bottom:10px}
    .chart-row{display:grid;grid-template-columns:1fr auto;align-items:center;gap:14px;margin:14px 0}
    .chart-row .label{font-size:18px}
    .bar{height:12px;background:rgba(255,255,255,.12);border-radius:10px;overflow:hidden;position:relative}
    .bar .fill{height:100%;width:0;border-radius:10px;background:linear-gradient(90deg,#ff43e5,#6c63ff)}
    .pct{font-family:"UnboundedLocal","Igra Sans",Inter,system-ui;font-weight:900;font-size:20px}
    .note{color:var(--muted);font-size:14px;margin-top:6px}
    /* donut */
    .donut-wrap{display:flex;align-items:center;justify-content:space-between;margin-top:8px}
    .donut-fig{width:180px;height:180px}
    .legend{display:flex;flex-direction:column;gap:18px}
    .legend .row{display:flex;align-items:center;gap:10px}
    .dot{width:10px;height:10px;border-radius:50%}
    .male{background:#ff43e5}
    .female{background:#6c63ff}
    .legend .val{font-family:"UnboundedLocal","Igra Sans",Inter,system-ui;font-weight:900;font-size:26px}
    .legend .lab{color:#a7b1c6;font-size:18px}
    @media(max-width:1100px){.stats-charts{grid-template-columns:1fr;}} 


    /* --- Animations --- */
    .bar .fill{width:0;transition:width 1.1s ease}
    .chart-card.inview .bar .fill{width:var(--w)}

    .donut-fig circle{transition:stroke-dashoffset 1.2s ease}
    .donut-fig .maleArc{stroke-dashoffset:100}
    .donut-fig .femaleArc{stroke-dashoffset:100}
    .chart-card.inview .donut-fig .maleArc{stroke-dashoffset:25}
    .chart-card.inview .donut-fig .femaleArc{stroke-dashoffset:-31.9}


    /* --- Animations for stats --- */
    .bar .fill{width:0;transition: width 1s ease-in-out}
    .chart-card.animate .bar .fill[data-w]{width:attr(data-w percentage)} /* fallback below with JS */
    .donut-fig circle.segment{transition: stroke-dasharray 1.2s ease-in-out, stroke-dashoffset 1.2s ease-in-out}
    .donut-fig circle.segment.init{stroke-dasharray:0 100}


    .pkg .per{font-size:11px;color:var(--muted);margin-top:4px;margin-bottom:2px}
    .pkg .price{margin-top:0}


    .rights{text-align:center;font-size:12px;color:#a7b1c6;margin:12px 0}

</style>
</head>
<body class="intro-active">
  <div class="intro" id="intro">
    <div class="title">АРЕНА</div>
    <div class="subtitle">ПОБЕДИТ ТОЛЬКО ОДИН</div>
  </div>

  <canvas id="stars" aria-hidden="true"></canvas>
  <div class="bg" aria-hidden="true">
    <div class="blob b1"></div>
    <div class="blob b2"></div>
    <div class="blob b3"></div>
  </div>

  <main class="wrap">
    <header class="reveal">
      <h1 class="title">Ваш бренд — центр Арены</h1>
      <p class="deck">Подписчики становятся героями Арены, а бренд — главным элементом шоу. Как это? Сейчас расскажу!</p>
      </header>

    <div class="hr reveal"></div>

    <section class="reveal delay-1">
      <h3 class="kicker">О проекте</h3>
      <h2 class="sub">Интерактив, который вовлекает</h2>
      <div class="text-box">
        «Битва на Арене» — серия интерактивных роликов в Instagram* (*соцсеть принадлежит компании Meta, признанной экстремистской в РФ). Зрители появляются в кадре в виде шариков и «толкаются» между собой. Это не статичная графика, а живая механика — за ней хочется наблюдать и в неё хочется попасть.
      </div>
    </section>

    <section class="reveal delay-2">
      <h3 class="kicker">Интеграция</h3>
      <h2 class="sub">Бренд — неподвижное ядро сюжета</h2>
      <div class="text-box">
        В центре сцены — круг с вашим названием или логотипом. Он остаётся в фокусе на протяжении всего ролика, а вокруг кипит динамика подписчиков. Сталкиваясь, они теряют жизни и исчезают с Арены, пока не останется один победитель. Бренд всегда остаётся центральным элементом шоу и запоминается без лишних слов.
      </div>
    </section>

    


    <section class="reveal delay-3">
      <h3 class="kicker">Как это выглядит</h3>
      <h2 class="sub">Шарики зрителей сталкиваются с вашим кругом</h2>
      <div class="arena-window">
        <canvas id="arena"></canvas>
        <img src="assets/brand.png" alt="Бренд" class="brand-image" id="brandImage" />
        <button class="speed-btn" id="speedBtn" aria-label="Перемотка">▷▷</button>
      </div>
    </section>

    <section class="reveal delay-4">
      <h3 class="kicker">Статистика</h3>
      <h2 class="sub">Цифры за период роста</h2>
      <section class="kpi">
        <div class="k"><div class="num">400&nbsp;000+</div><div class="lab">просмотров за 2 недели</div></div>
        <div class="k"><div class="num">13&nbsp;200+</div><div class="lab">взаимодействий за 2 недели</div></div>
        <div class="k"><div class="num">5&nbsp;696+</div><div class="lab">новых подписчиков за 2 недели</div></div>
        <div class="k"><div class="num">~35&nbsp;000+</div><div class="lab">просмотров на ролик за 2 недели</div></div>
      </section>

      <div class="stats-charts">
        <!-- Топ стран -->
        <div class="chart-card">
          <h3>Топ стран</h3>
          <div class="chart-row">
            <div class="label">Российская Федерация</div>
            <div class="pct">43,3%</div>
          </div>
          <div class="bar"><div class="fill" style="--w:43.3%"></div></div>

          <div class="chart-row">
            <div class="label">Кыргызстан</div>
            <div class="pct">14,2%</div>
          </div>
          <div class="bar"><div class="fill" style="--w:14.2%"></div></div>

          <div class="chart-row">
            <div class="label">Узбекистан</div>
            <div class="pct">10,3%</div>
          </div>
          <div class="bar"><div class="fill" style="--w:10.3%"></div></div>

          <div class="chart-row">
            <div class="label">Казахстан</div>
            <div class="pct">8,5%</div>
          </div>
          <div class="bar"><div class="fill" style="--w:8.5%"></div></div>
        </div>

        <!-- Топ возрастных диапазонов -->
        <div class="chart-card">
          <h3>Топ возрастных диапазонов</h3>
          <div class="chart-row">
            <div class="label">18–24</div>
            <div class="pct">41,7%</div>
          </div>
          <div class="bar"><div class="fill" style="--w:41.7%"></div></div>

          <div class="chart-row">
            <div class="label">25–34</div>
            <div class="pct">25,5%</div>
          </div>
          <div class="bar"><div class="fill" style="--w:25.5%"></div></div>

          <div class="chart-row">
            <div class="label">13–17</div>
            <div class="pct">23,6%</div>
          </div>
          <div class="bar"><div class="fill" style="--w:23.6%"></div></div>

          <div class="chart-row">
            <div class="label">35–44</div>
            <div class="pct">6,2%</div>
          </div>
          <div class="bar"><div class="fill" style="--w:6.2%"></div></div>
        </div>

        <!-- Пол -->
        <div class="chart-card">
          <h3>Пол</h3>
          <div class="donut-wrap">
            <div class="legend">
              <div class="row">
                <div class="val">56,9%</div>
              </div>
              <div class="lab"><span class="dot male"></span> Мужчины</div>
              <div class="row">
                <div class="val">43,1%</div>
              </div>
              <div class="lab"><span class="dot female"></span> Женщины</div>
            </div>
            <svg viewBox="0 0 42 42" class="donut-fig" aria-label="Пол">
              <circle cx="21" cy="21" r="15.9155" fill="transparent" stroke="rgba(255,255,255,.12)" stroke-width="5"></circle>
              <!-- Мужчины -->
              <circle cx="21" cy="21" r="15.9155" fill="transparent" stroke="#ff43e5" stroke-width="5" stroke-dasharray="56.9 43.1" stroke-dashoffset="25"></circle></circle>
              <!-- Женщины -->
              <circle cx="21" cy="21" r="15.9155" fill="transparent" stroke="#6c63ff" stroke-width="5" stroke-dasharray="43.1 56.9" stroke-dashoffset="-31.9"></circle></circle>
            </svg>
          </div>
        </div>
      </div>

    </section>

    <div class="hr reveal"></div>

    <section class="reveal" id="packages">
      <h3 class="kicker">Пакеты</h3>
      <h2 class="sub">Стоимость интеграции</h2>
      <div class="packages">
        <div class="pkg"><h3>Разовое</h3><div>1 ролик</div><div class="per">~ 7&nbsp;000 ₽/ролик</div><div class="price">7&nbsp;000 ₽</div></div>
        <div class="pkg"><h3>Минимум</h3><div>5 роликов</div><div class="per">~ 6&nbsp;000 ₽/ролик</div><div class="price">30&nbsp;000 ₽</div></div>
        <div class="pkg"><h3>Стандарт</h3><div>10 роликов</div><div class="per">~ 5&nbsp;500 ₽/ролик</div><div class="price">55&nbsp;000 ₽</div></div>
        <div class="pkg"><h3>Максимум</h3><div>20 роликов</div><div class="per">~ 5&nbsp;000 ₽/ролик</div><div class="price">100&nbsp;000 ₽</div></div>
        <div class="pkg"><h3>VIP</h3><div>30 роликов</div><div class="per">~ 4&nbsp;500 ₽/ролик</div><div class="price">135&nbsp;000 ₽</div></div>
      </div>
    </section>

    <section class="reveal delay-3">
      <h3 class="kicker">Почему именно я?</h3>
      <h2 class="sub">Не просто охваты — вовлечённые зрители и понятный эффект</h2>
      <div class="text-box">
        Каждый ролик собирает сотни комментариев и споров — люди вовлекаются и возвращаются.<br/>
        Бренд остаётся в <b>центре внимания</b> и <b>запоминается</b>. 
        <div class="ul" style="margin-top:10px; padding-left:20px">
          <div>✔ Живой актив под каждым видео.</div>
          <div>✔ Натуральная интеграция в механику шоу.</div>
          <div>✔ Рост вовлечённости и подписчиков.</div>
        </div>
      </div>
    </section>


    <footer class="footer">Instagram*: <a href="https://instagram.com/ave7eva" target="_blank" rel="noopener">@ave7eva</a></footer>
<div class="rights">© Все права на данный контент и проект принадлежат его автору @ave7eva</div>
  </main>

<script>
// Intro: fade text smoothly with opacity while background deblurs (disable animation, then transition opacity)
(function(){
  const body=document.body;
  const intro=document.getElementById('intro');
  body.classList.add('intro-active');
  setTimeout(()=>{
    // trigger deblur + text fade
    body.classList.remove('intro-active');      // start deblurring page
    // force reflow to ensure transition kicks in after animation is disabled
    void intro.offsetWidth;
    intro.classList.add('out');                 // kills animation & transitions opacity -> 0
    intro.classList.add('fade-out');            // overlay opacity -> 0
  }, 1600);
  setTimeout(()=>{ intro.remove(); }, 2800);
})();

// Scroll reveal
(function(){
  const els=[...document.querySelectorAll('.reveal')];
  const io=new IntersectionObserver((entries)=>{
    entries.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add('in'); io.unobserve(e.target);} });
  },{threshold:.15});
  els.forEach(el=>io.observe(el));
})();

// Stars background
(function(){
  const c=document.getElementById('stars');
  const x=c.getContext('2d');
  let W,H,DPR=Math.min(2,window.devicePixelRatio||1);
  const stars=[]; const N=240;
  function resize(){ W=innerWidth*DPR; H=innerHeight*DPR; c.width=W; c.height=H; }
  function seed(){ stars.length=0; for(let i=0;i<N;i++){ stars.push({
        x: Math.random()*W, y: Math.random()*H,
        r: Math.random()*1.6*DPR + 0.3*DPR,
        v: (Math.random()*0.15 + 0.02)*DPR,
        a: Math.random()*Math.PI*2,
        tw: Math.random()*0.05 + 0.02
      }); } }
  function step(){ x.clearRect(0,0,W,H);
    for(const s of stars){ s.x += Math.cos(s.a)*s.v; s.y += Math.sin(s.a)*s.v*0.2;
      if(s.x<0) s.x=W; if(s.x>W) s.x=0; if(s.y<0) s.y=H; if(s.y>H) s.y=0;
      const alpha = 0.6 + 0.4*Math.sin(performance.now()*s.tw/1000 + s.a);
      x.globalAlpha=alpha; x.beginPath(); x.arc(s.x,s.y,s.r,0,Math.PI*2); x.fillStyle="#ffffff"; x.fill(); }
    x.globalAlpha=1; requestAnimationFrame(step); }
  const onResize=()=>{ resize(); seed(); };
  addEventListener('resize', onResize); onResize(); step();
})();

// Arena physics — restored from v4
(function(){
  const canvas=document.getElementById('arena');
  const ctx=canvas.getContext('2d');
  const brandImg=document.getElementById('brandImage');
  const avatarImg=new Image();
  avatarImg.src='assets/avatar.png';

  let W,H,DPR=Math.min(2,window.devicePixelRatio||1);
  const balls=[]; const center={x:0,y:0,r:100};
  const count=52;
  const baseSpeed=1.4;
  let speedTarget=1.0;
  let speedFactor=1.0;

  function resize(){
    const rect=canvas.getBoundingClientRect();
    W=rect.width*DPR;H=rect.height*DPR; canvas.width=W;canvas.height=H;
    center.x=W/2;center.y=H/2;
    const br=brandImg.getBoundingClientRect().width*DPR/2;
    center.r=br;
  }
  resize(); addEventListener('resize',resize);

  function rand(a,b){return Math.random()*(b-a)+a}
  const r=12*DPR;
  const ring = Math.max(2, 2*DPR);

  function seedPosition(){
    const ringR = Math.min(W,H)/2 - 40*DPR;
    const cluster = Math.floor(Math.random()*3);
    const baseAng = (cluster/3)*Math.PI*2 + rand(-0.3,0.3);
    const dist = Math.max(center.r+50*DPR, ringR*rand(0.4,0.9));
    return {
      x: center.x + Math.cos(baseAng)*dist + rand(-30*DPR,30*DPR),
      y: center.y + Math.sin(baseAng)*dist + rand(-30*DPR,30*DPR),
    };
  }

  for(let i=0;i<count;i++){
    const p = seedPosition();
    balls.push({ x:p.x, y:p.y, r, vx:rand(-baseSpeed,baseSpeed), vy:rand(-baseSpeed,baseSpeed) });
  }

  function collideBrand(b){
    const dx=b.x-center.x, dy=b.y-center.y;
    const dist=Math.hypot(dx,dy);
    const min=b.r+center.r;
    if(dist<min){
      const nx=dx/(dist||1), ny=dy/(dist||1);
      const overlap=min-dist;
      b.x+=nx*overlap; b.y+=ny*overlap;
      const dot=b.vx*nx+b.vy*ny;
      b.vx-=2*dot*nx; b.vy-=2*dot*ny;
    }
  }
  function collideBalls(a,b){
    const dx=b.x-a.x, dy=b.y-a.y;
    const dist=Math.hypot(dx,dy), min=a.r+b.r;
    if(dist<min && dist>0){
      const nx=dx/dist, ny=dy/dist, overlap=(min-dist)/2;
      a.x-=nx*overlap; a.y-=ny*overlap;
      b.x+=nx*overlap; b.y+=ny*overlap;
      const tx=-ny, ty=nx;
      const tA=a.vx*tx+a.vy*ty, tB=b.vx*tx+b.vy*ty;
      const nA=a.vx*nx+a.vy*ny, nB=b.vx*nx+b.vy*ny;
      a.vx=tx*tA+nx*nB; a.vy=ty*tA+ny*nB;
      b.vx=tx*tB+nx*nA; b.vy=ty*tB+ny*nA;
    }
  }

  function drawAvatar(b){
    ctx.beginPath();
    ctx.arc(b.x,b.y,b.r,0,Math.PI*2);
    ctx.fillStyle="rgba(255,255,255,0.95)";
    ctx.fill();

    const inner = b.r - ring;
    ctx.save();
    ctx.beginPath();
    ctx.arc(b.x,b.y,inner,0,Math.PI*2);
    ctx.clip();

    const overscan = 1;
    const size = inner*2 + overscan*2;
    ctx.drawImage(avatarImg, b.x-inner-overscan, b.y-inner-overscan, size, size);
    ctx.restore();
  }

  function step(){
    speedFactor += (speedTarget - speedFactor)*0.08;
    ctx.clearRect(0,0,W,H);
    for(const b of balls){
      b.x+=b.vx*speedFactor; b.y+=b.vy*speedFactor;
      if(b.x-b.r<0){b.x=b.r; b.vx*=-1}
      if(b.x+b.r>W){b.x=W-b.r; b.vx*=-1}
      if(b.y-b.r<0){b.y=b.r; b.vy*=-1}
      if(b.y+b.r>H){b.y=H-b.r; b.vy*=-1}
    }
    for(let i=0;i<balls.length;i++){
      collideBrand(balls[i]);
      for(let j=i+1;j<balls.length;j++){collideBalls(balls[i],balls[j]);}
    }
    for(const b of balls){ drawAvatar(b); }
    requestAnimationFrame(step);
  }
  step();

  const btn = document.getElementById('speedBtn');
  const press = ()=>{ speedTarget = 5.0; };
  const release = ()=>{ speedTarget = 1.0; };
  btn.addEventListener('mousedown', press);
  btn.addEventListener('touchstart', (e)=>{ e.preventDefault(); press(); }, {passive:false});
  window.addEventListener('mouseup', release);
  window.addEventListener('touchend', release);
})();

// Animate stats on reveal
(function(){
  const cards = document.querySelectorAll('.chart-card');
  const io = new IntersectionObserver((entries)=>{
    entries.forEach(e=>{
      if(e.isIntersecting){
        e.target.classList.add('inview');
        io.unobserve(e.target);
      }
    });
  },{threshold:0.35});
  cards.forEach(c=>io.observe(c));
})();


// --- Stats charts reveal animation ---
(function(){
  const cards = document.querySelectorAll('.stats-charts .chart-card');
  const io = new IntersectionObserver((entries)=>{
    entries.forEach(entry=>{
      if(entry.isIntersecting){
        const card = entry.target;
        card.classList.add('animate');
        // bars
        card.querySelectorAll('.bar .fill[data-w]').forEach(el=>{
          el.style.width = el.getAttribute('data-w');
        });
        // donut
        card.querySelectorAll('svg.donut-fig circle.segment.init').forEach(c=>{
          const a = c.getAttribute('data-dasharray');
          const off = c.getAttribute('data-dashoffset') || '0';
          c.style.strokeDasharray = a;
          c.style.strokeDashoffset = off;
          c.classList.remove('init');
        });
        io.unobserve(card);
      }
    });
  }, {threshold: 0.35});
  cards.forEach(c=>io.observe(c));
})();


// Fit subtitle width to exactly match the "АРЕНА" title width
(function(){
  const title = document.querySelector('.intro .title');
  const sub = document.querySelector('.intro .subtitle');
  if(!title || !sub) return;

  function fitSubtitle(){
    // target width equals title's visible width
    const target = title.getBoundingClientRect().width;
    if (!target || !isFinite(target)) return;
    // binary search for font-size that fits in target width
    let lo = 8, hi = 420, best = lo, i = 0;
    sub.style.whiteSpace = 'nowrap';
    while (i++ < 14 && hi - lo > 0.5){
      let mid = (lo + hi) / 2;
      sub.style.fontSize = mid + 'px';
      const w = sub.getBoundingClientRect().width;
      if (w <= target){ best = mid; lo = mid; } else { hi = mid; }
    }
    sub.style.fontSize = Math.max(8, Math.min(420, best)) + 'px';
  }
  const debounced = (()=>{
    let t; 
    return ()=>{ clearTimeout(t); t = setTimeout(fitSubtitle, 50); };
  })();

  // run on load, after fonts, and on resize/orientation
  window.addEventListener('load', fitSubtitle);
  document.fonts && document.fonts.ready.then(fitSubtitle);
  window.addEventListener('resize', debounced);
  window.addEventListener('orientationchange', debounced);
  // also run once after the intro fade-out starts to avoid blur affecting sizes
  setTimeout(fitSubtitle, 120);
})();

</script>
</body>
</html>
